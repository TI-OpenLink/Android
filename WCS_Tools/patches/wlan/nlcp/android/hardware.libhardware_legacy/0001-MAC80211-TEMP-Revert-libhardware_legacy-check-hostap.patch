From 0e6b4521d44119d3f5ce683a8fa60f60853f6e2d Mon Sep 17 00:00:00 2001
From: Vishal Mahaveer <vishalm@ti.com>
Date: Mon, 2 May 2011 14:54:40 -0600
Subject: [PATCH 1/2] MAC80211 TEMP Revert "libhardware_legacy - check hostapd.conf file existes before loading softap"

This reverts commit be6b775aa516dfcc28b51496d331e903dea9fb45.
---
 wifi/wifi.c |   57 ---------------------------------------------------------
 1 files changed, 0 insertions(+), 57 deletions(-)

diff --git a/wifi/wifi.c b/wifi/wifi.c
index c5ed2bc..8a3581b 100644
--- a/wifi/wifi.c
+++ b/wifi/wifi.c
@@ -84,9 +84,6 @@ static const char AP_DRIVER_MODULE_PATH[]  = "/system/etc/wifi/softap/tiap_drv.k
 static const char AP_DRIVER_MODULE_ARG[]   = "";
 static const char AP_FIRMWARE_LOADER[]     = "wlan_ap_loader";
 static const char AP_DRIVER_PROP_NAME[]    = "wlan.ap.driver.status";
-static const char HOSTAPD_CONFIG_TEMPLATE[]= "/system/etc/wifi/softap/hostapd.conf";
-static const char HOSTAPD_CONFIG_FILE[]    = "/data/misc/wifi/hostapd.conf";
-#define MAX_BUFFER_SIZE 2048
 #endif
 
 static int insmod(const char *filename, const char *args)
@@ -148,55 +145,6 @@ const char *get_dhcp_error_string() {
 }
 
 #ifdef OMAP_ENHANCEMENT
-int ensure_hostapd_config_file_exists()
-{
-    char buf[MAX_BUFFER_SIZE];
-    int srcfd, destfd;
-    int nread;
-
-    if (access(HOSTAPD_CONFIG_FILE, R_OK|W_OK) == 0) {
-        return 0;
-    } else if (errno != ENOENT) {
-        LOGE("Cannot access \"%s\": %s", HOSTAPD_CONFIG_FILE, strerror(errno));
-        return -1;
-    }
-
-    srcfd = open(HOSTAPD_CONFIG_TEMPLATE, O_RDONLY);
-    if (srcfd < 0) {
-        LOGE("Cannot open \"%s\": %s", HOSTAPD_CONFIG_TEMPLATE, strerror(errno));
-        return -1;
-    }
-
-    destfd = open(HOSTAPD_CONFIG_FILE, O_CREAT|O_WRONLY, 0660);
-    if (destfd < 0) {
-        close(srcfd);
-        LOGE("Cannot create \"%s\": %s", HOSTAPD_CONFIG_FILE, strerror(errno));
-        return -1;
-    }
-
-    while ((nread = read(srcfd, buf, sizeof(buf))) != 0) {
-        if (nread < 0) {
-            LOGE("Error reading \"%s\": %s", HOSTAPD_CONFIG_TEMPLATE, strerror(errno));
-            close(srcfd);
-            close(destfd);
-            unlink(HOSTAPD_CONFIG_FILE);
-            return -1;
-        }
-        write(destfd, buf, nread);
-    }
-
-    close(destfd);
-    close(srcfd);
-
-    if (chown(HOSTAPD_CONFIG_FILE, AID_SYSTEM, AID_WIFI) < 0) {
-        LOGE("Error changing group ownership of %s to %d: %s",
-             HOSTAPD_CONFIG_FILE, AID_WIFI, strerror(errno));
-        unlink(HOSTAPD_CONFIG_FILE);
-        return -1;
-    }
-    return 0;
-}
-
 static int check_hotspot_driver_loaded() {
     char driver_status[PROPERTY_VALUE_MAX];
     FILE *proc;
@@ -237,11 +185,6 @@ int hotspot_load_driver()
         return 0;
     }
 
-    if (ensure_hostapd_config_file_exists() < 0) {
-        LOGE("HotSpot config file error");
-        return -1;
-    }
-
     if (insmod(AP_DRIVER_MODULE_PATH, AP_DRIVER_MODULE_ARG) < 0)
         return -1;
 
-- 
1.7.0.4

