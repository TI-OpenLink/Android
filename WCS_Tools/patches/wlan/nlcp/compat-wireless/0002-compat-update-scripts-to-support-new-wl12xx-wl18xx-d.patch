From 9af61296ab03e87e1ec531a67bfb4c299d642307 Mon Sep 17 00:00:00 2001
From: Eliad Peller <eliad@wizery.com>
Date: Mon, 23 Jan 2012 17:13:31 +0200
Subject: [PATCH 2/3] compat: update scripts to support new wl12xx/wl18xx
 drivers


Signed-off-by: Eliad Peller <eliad@wizery.com>
---
 scripts/admin-update.sh |    9 +++++++--
 scripts/driver-select   |   27 +++++++++++++++++++++------
 2 files changed, 28 insertions(+), 8 deletions(-)

diff --git a/scripts/admin-update.sh b/scripts/admin-update.sh
index 1aad4fa..d087f43 100755
--- a/scripts/admin-update.sh
+++ b/scripts/admin-update.sh
@@ -247,8 +247,13 @@ DRIVERS="$DRIVERS drivers/net/wireless/rtlwifi/rtl8192se"
 DRIVERS="$DRIVERS drivers/net/wireless/rtlwifi/rtl8192de"
 DRIVERS="$DRIVERS drivers/net/wireless/libertas_tf"
 DRIVERS="$DRIVERS drivers/net/wireless/ipw2x00"
-DRIVERS="$DRIVERS drivers/net/wireless/wl12xx"
-DRIVERS="$DRIVERS drivers/net/wireless/wl1251"
+#DRIVERS="$DRIVERS drivers/net/wireless/wl12xx"
+#DRIVERS="$DRIVERS drivers/net/wireless/wl1251"
+DRIVERS="$DRIVERS drivers/net/wireless/ti"
+DRIVERS="$DRIVERS drivers/net/wireless/ti/wl12xx"
+DRIVERS="$DRIVERS drivers/net/wireless/ti/wl18xx"
+DRIVERS="$DRIVERS drivers/net/wireless/ti/wlcore"
+DRIVERS="$DRIVERS drivers/net/wireless/ti/wl1251"
 DRIVERS="$DRIVERS drivers/net/wireless/iwmc3200wifi"
 DRIVERS="$DRIVERS drivers/net/wireless/orinoco"
 DRIVERS="$DRIVERS drivers/net/wireless/mwifiex"
diff --git a/scripts/driver-select b/scripts/driver-select
index f8ca02f..e73c858 100755
--- a/scripts/driver-select
+++ b/scripts/driver-select
@@ -9,6 +9,7 @@ ATH_MAKEFILE="drivers/net/wireless/ath/Makefile"
 ATH9K_MAKEFILE="drivers/net/wireless/ath/ath9k/Makefile"
 BRCM80211_MAKEFILE="drivers/net/wireless/brcm80211/Makefile"
 RT2X00_MAKEFILE="drivers/net/wireless/rt2x00/Makefile"
+TI_MAKEFILE="drivers/net/wireless/ti/Makefile"
 NET_WIRELESS_MAKEFILE="net/wireless/Makefile"
 EEPROM_MAKEFILE="drivers/misc/eeprom/Makefile"
 DRIVERS_NET_ATHEROS="drivers/net/ethernet/atheros/Makefile"
@@ -33,7 +34,7 @@ PURPLE="\033[35m"
 CYAN="\033[36m"
 UNDERLINE="\033[02m"
 
-SUPPORTED_80211_DRIVERS="ath5k ath9k ath9k_htc carl9170 ath6kl b43 zd1211rw rt2x00 wl1251 wl12xx brcmsmac brcmfmac"
+SUPPORTED_80211_DRIVERS="ath5k ath9k ath9k_htc carl9170 ath6kl b43 zd1211rw rt2x00 wl1251 wl12xx wl18xx brcmsmac brcmfmac"
 
 # b43 needs some more work for driver-select, the SSB stuff, plus
 # what if you update b44 but not b43? It will bust.
@@ -57,6 +58,7 @@ function usage {
 	echo -e "\t${CYAN}rtl818x${NORMAL} < ${PURPLE} rtl8180 rtl8187 ${NORMAL}>"
 	echo -e "\t${CYAN}rtlwifi${NORMAL} < ${PURPLE} rtl8192ce ${NORMAL}>"
 	echo -e "\t${CYAN}ti${NORMAL} < ${PURPLE} wl1251 wl12xx (SPI and SDIO)${NORMAL}>"
+	echo -e "\t${CYAN}wl18xx${NORMAL} < ${PURPLE} wl18xx (SPI and SDIO)${NORMAL}>"
 	
 	echo -e "\nSupported group drivers: Bluetooth & Ethernet:"
 	echo -e "\t${CYAN}atlxx${NORMAL} < ${PURPLE} atl1 atl2 atl1e atl1c ${NORMAL}>"
@@ -243,6 +245,12 @@ function select_brcm80211_driver
 	perl -i -ne 'print if /'$1'/ || /CONFIG_BRCMUTIL/ ' $BRCM80211_MAKEFILE
 }
 
+function select_ti_driver
+{
+	backup_file $TI_MAKEFILE
+	perl -i -ne 'print if /'$1'/ || /CONFIG_WLCORE/ || /CONFIG_WL12XX_PLATFORM_DATA/' $TI_MAKEFILE
+}
+
 function restore_file {
 	#ORIG=$(shell ${1%%.${BACKUP_EXT}})
 	ORIG=${1%%.bk}
@@ -348,9 +356,8 @@ case $1 in
 		disable_bt_usb_ethernet_var
 		disable_lib80211
 		;;
-	ti)
-		select_drivers		CONFIG_WL1251 \
-					CONFIG_WL12XX
+	wl_ti)
+		select_drivers		CONFIG_WL_TI
 		disable_staging
 		disable_var_01
 		;;
@@ -424,12 +431,20 @@ case $1 in
 		disable_var_02
 		;;
 	wl1251)
-		select_drivers		CONFIG_WL1251
+		select_drivers		CONFIG_WL_TI
+		select_ti_driver	CONFIG_WL1251
 		disable_staging
 		disable_var_01
 		;;
 	wl12xx)
-		select_drivers		CONFIG_WL12XX
+		select_drivers		CONFIG_WL_TI
+		select_ti_driver	CONFIG_WL12XX
+		disable_staging
+		disable_var_01
+		;;
+	wl18xx)
+		select_drivers		CONFIG_WL_TI
+		select_ti_driver	CONFIG_WL18XX
 		disable_staging
 		disable_var_01
 		;;
-- 
1.7.6.401.g6a319

